<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <title>Protein Mutations</title>
        <style>
            #app {
                margin: 0%;
                border: 0ch;
                position:absolute;
                /* left: 100px; */
                /* top: 100px; */
                width: 75%;
                height: 75%;
                align-self: center;
                text-align: center;
            }
        </style>
        <link rel="stylesheet" type="text/css" href="http://localhost:1338/build/viewer/molstar.css" />
    </head>
    <body>
        <div style="text-align: center;align-content: center;">
            <h3>Test</h3>
            <div style="align-self: flex-start; padding-left: 50px;"></div>
            <div style="align-content: flex-end;">
                <div id="app"></div>
                <script type="text/javascript" src="http://localhost:1338/build/viewer/molstar.js"></script>
                <script type="text/javascript">
                    function getParam(name, regex) {
                        var r = new RegExp(name + '=' + '(' + regex + ')[&]?', 'i');
                        return decodeURIComponent(((window.location.search || '').match(r) || [])[1] || '');
                    }

                    var debugMode = getParam('debug-mode', '[^&]+').trim() === '1';
                    if (debugMode) molstar.setDebugMode(debugMode, debugMode);

                    var hideControls = getParam('hide-controls', '[^&]+').trim() === '1';
                    var collapseLeftPanel = getParam('collapse-left-panel', '[^&]+').trim() === '1';
                    var pdbProvider = getParam('pdb-provider', '[^&]+').trim().toLowerCase();
                    var emdbProvider = getParam('emdb-provider', '[^&]+').trim().toLowerCase();
                    var viewer = new molstar.Viewer('app', {
                        layoutIsExpanded: false,
                        layoutShowRemoteState: false,
                        layoutShowSequence: true,
                        layoutShowLog: false,
                        layoutShowLeftPanel: false,
                        viewportShowExpand: false,
                        viewportShowSelectionMode: false,
                        viewportShowAnimation: false,
                        layoutShowControls: true,
                        viewportShowExpand: false,
                        collapseLeftPanel: collapseLeftPanel,
                        pdbProvider: pdbProvider || 'pdbe',
                        emdbProvider: emdbProvider || 'pdbe',
                    });

                    var snapshotId = getParam('snapshot-id', '[^&]+').trim();
                    if (snapshotId) viewer.setRemoteSnapshot(snapshotId);

                    var snapshotUrl = getParam('snapshot-url', '[^&]+').trim();
                    var snapshotUrlType = getParam('snapshot-url-type', '[^&]+').toLowerCase().trim() || 'molj';
                    if (snapshotUrl && snapshotUrlType) viewer.loadSnapshotFromUrl(snapshotUrl, snapshotUrlType);

                    var structureUrl = getParam('structure-url', '[^&]+').trim();
                    var structureUrlFormat = getParam('structure-url-format', '[a-z]+').toLowerCase().trim();
                    // console.log(structureUrlFormat);
                    var structureUrlIsBinary = getParam('structure-url-is-binary', '[^&]+').trim() === '1';
                    // if (structureUrl) {
                    //     viewer.loadStructureFromUrl(structureUrl, structureUrlFormat, structureUrlIsBinary);
                    //     for (const s of viewer.plugin.managers.structure.hierarchy.current.structures) {
                    //         viewer.plugin.managers.structure.component.updateRepresentationsTheme(s.components, { color: OccupancyColorThemeProvider });
                    //         console.log(s.components);
                    //         }
                    // }
                    viewer.loadStructureFromUrl("http://localhost:1338/data/mutations/{{pdb}}.pdb", "pdb", false);

                    var pdb = getParam('pdb', '[^&]+').trim();
                    if (pdb) viewer.loadPdb(pdb);

                    var pdbDev = getParam('pdb-dev', '[^&]+').trim();
                    if (pdbDev) viewer.loadPdbDev(pdbDev);

                    var emdb = getParam('emdb', '[^&]+').trim();
                    if (emdb) viewer.loadEmdb(emdb);
                </script>
            </div>
        </div>
    </body>
</html>